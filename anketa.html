<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анкета для правового анализа судебной перспективы банкротства</title>
    <style>
        @font-face {
            font-family: 'Circe';
            src: local('Arial');
            font-weight: normal;
            font-style: normal;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Circe', Arial, sans-serif;
            background: #f5f5f5;
            color: #68311f;
            line-height: 1.6;
            padding: 20px 10px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #f26649;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        h2 {
            color: #f26649;
            font-size: 20px;
            margin-bottom: 10px;
            margin-top: 20px;
        }
        
        .step-description {
            color: #68311f;
            margin-bottom: 25px;
            font-size: 15px;
        }
        
        .question-block {
            margin-bottom: 25px;
        }
        
        .question-label {
            display: block;
            color: #68311f;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .question-hint {
            display: block;
            color: #c59368;
            font-size: 13px;
            margin-bottom: 10px;
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 15px;
            color: #68311f;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #f26649;
        }
        
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        input[type="radio"],
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .radio-option label,
        .checkbox-option label {
            cursor: pointer;
            font-size: 15px;
        }
        
        .error-message {
            color: #c59368;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .btn-back {
            background: #e0e0e0;
            color: #68311f;
        }
        
        .btn-back:hover:not(:disabled) {
            opacity: 0.8;
        }
        
        .btn-next,
        .btn-finish {
            background: #f26649;
            color: white;
            flex: 1;
        }
        
        .btn-next:hover:not(:disabled),
        .btn-finish:hover:not(:disabled) {
            opacity: 0.9;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .hidden {
            display: none !important;
        }
        
        .info-block {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 3px solid #f26649;
        }
        
        .info-block h3 {
            color: #f26649;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .info-block p {
            color: #68311f;
            font-size: 14px;
        }
        
        .bank-block,
        .credit-block {
            background: #fafafa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .bank-block h3 {
            color: #f26649;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .credit-block h4 {
            color: #68311f;
            font-size: 15px;
            margin-bottom: 10px;
        }
        
        .final-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .final-screen h1 {
            margin-bottom: 20px;
        }
        
        .final-screen p {
            font-size: 16px;
            line-height: 1.8;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            h2 {
                font-size: 18px;
            }
            
            .navigation {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app"></div>
    </div>

    <script>
        const API_URL = 'https://mail-ru-hswz.onrender.com/api/submit';
        
        const anketaData = {
            meta: {
                schema_version: "1.0.0",
                created_at: new Date().toISOString(),
                completed_at: null,
                client_timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                source: {
                    platform: "standalone",
                    page_url: window.location.href
                }
            },
            answers: {
                step1_general: {
                    region: "",
                    fullName: "",
                    wasBankrupt: null,
                    bankruptYear: null,
                    bankruptType: null
                },
                step2_family: {
                    isMarried: null,
                    wasMarriedLast3Years: null,
                    spouseTransactions: null,
                    spouseTransactionTypes: [],
                    spouseProperty: []
                },
                step3_children: {
                    childrenCount: "",
                    monthlyExpenses: null
                },
                step4_debts: {
                    totalDebt: null,
                    nonDischargeable: ""
                },
                step5_banks: {
                    selectedBanks: [],
                    otherBankName: ""
                },
                step6_bankCredits: {},
                step7_mfo: {
                    mfoCount: null,
                    mfoTotalDebt: null
                },
                step8_spending: {
                    purposes: [],
                    otherPurpose: "",
                    largePurchases: null,
                    propertyPurchased: null,
                    propertyType: null,
                    transfersToThirdParties: null
                },
                step9_income: {
                    monthlyIncome: null,
                    hasOfficialJob: null,
                    hasSelfEmployment: null,
                    hasOtherIncome: null
                },
                step10_expensesAndBehavior: {
                    alimony: null,
                    utilities: null,
                    rent: null,
                    otherExpenses: null,
                    hasOverdue: null,
                    maxOverduePeriod: null,
                    requestedRestructuring: null,
                    restructuringWhen: null,
                    newCreditsAfterTrouble: null,
                    newCreditsWhen: null
                },
                step11_property: {
                    onlyHome: null,
                    propertyShares: null,
                    mortgageContracts: null,
                    collateralProperty: null,
                    financialAssets: null,
                    vehicles: null,
                    otherProperty: null
                },
                step12_legal: {
                    incapacityDecision: null,
                    criminalRecord: null
                }
            }
        };

        let currentStep = 1;

        const regions = [
            "Республика Адыгея", "Республика Алтай", "Республика Башкортостан", "Республика Бурятия",
            "Республика Дагестан", "Республика Ингушетия", "Кабардино-Балкарская Республика",
            "Республика Калмыкия", "Карачаево-Черкесская Республика", "Республика Карелия",
            "Республика Коми", "Республика Крым", "Республика Марий Эл", "Республика Мордовия",
            "Республика Саха (Якутия)", "Республика Северная Осетия — Алания", "Республика Татарстан",
            "Республика Тыва", "Удмуртская Республика", "Республика Хакасия", "Чеченская Республика",
            "Чувашская Республика", "Алтайский край", "Забайкальский край", "Камчатский край",
            "Краснодарский край", "Красноярский край", "Пермский край", "Приморский край",
            "Ставропольский край", "Хабаровский край", "Амурская область", "Архангельская область",
            "Астраханская область", "Белгородская область", "Брянская область", "Владимирская область",
            "Волгоградская область", "Вологодская область", "Воронежская область", "Ивановская область",
            "Иркутская область", "Калининградская область", "Калужская область", "Кемеровская область",
            "Кировская область", "Костромская область", "Курганская область", "Курская область",
            "Ленинградская область", "Липецкая область", "Магаданская область", "Московская область",
            "Мурманская область", "Нижегородская область", "Новгородская область", "Новосибирская область",
            "Омская область", "Оренбургская область", "Орловская область", "Пензенская область",
            "Псковская область", "Ростовская область", "Рязанская область", "Самарская область",
            "Саратовская область", "Сахалинская область", "Свердловская область", "Смоленская область",
            "Тамбовская область", "Тверская область", "Томская область", "Тульская область",
            "Тюменская область", "Ульяновская область", "Челябинская область", "Ярославская область",
            "Москва", "Санкт-Петербург", "Севастополь", "Еврейская автономная область",
            "Ненецкий автономный округ", "Ханты-Мансийский автономный округ — Югра",
            "Чукотский автономный округ", "Ямало-Ненецкий автономный округ"
        ];

        const banks = [
            "Сбербанк", "ВТБ", "Газпромбанк", "Альфа-Банк", "Россельхозбанк",
            "Московский кредитный банк (МКБ)", "Т-Банк (Тинькофф)", "Совкомбанк",
            "Банк ДОМ.РФ", "Райффайзенбанк", "Банк «Россия»", "Банк «Санкт-Петербург»",
            "Новиком", "Ак Барс Банк", "Банк Уралсиб", "Другой банк"
        ];

        function getAnketaResult() {
            return {
                raw: anketaData,
                derived: {}
            };
        }

        function clearValue(value) {
            if (typeof value === 'string') return "";
            if (typeof value === 'number') return null;
            if (Array.isArray(value)) return [];
            return null;
        }

        function renderStep1() {
            return `
                <h1>Общие сведения</h1>
                <p class="step-description">Пожалуйста, укажите общие сведения. Эта информация необходима для определения применимого порядка рассмотрения дела и территориальной подсудности, а также общего понимания финансовой ситуации.</p>
                
                <div class="question-block">
                    <label class="question-label">Регион регистрации по месту жительства</label>
                    <span class="question-hint">Укажите субъект Российской Федерации, в котором вы зарегистрированы по месту жительства (прописка).</span>
                    <select id="region" onchange="updateData('step1_general', 'region', this.value); updateButtonState()">
                        <option value="">Выберите регион</option>
                        ${regions.map(r => `<option value="${r}" ${anketaData.answers.step1_general.region === r ? 'selected' : ''}>${r}</option>`).join('')}
                    </select>
                    <span class="error-message" id="error-region">Пожалуйста, заполните поле</span>
                </div>

                <div class="info-block">
                    <h3>Укажите ваши данные (защита от мошенников)</h3>
                    <p>Данные используются для подтверждения добросовестности обращения и защиты от недобросовестных заявок.</p>
                </div>

                <div class="question-block">
                    <label class="question-label">Фамилия и имя</label>
                    <span class="question-hint">Введите ваши фамилию и имя так, как они указаны в документах.</span>
                    <input type="text" id="fullName" placeholder="Иванов Иван" value="${anketaData.answers.step1_general.fullName}" oninput="updateData('step1_general', 'fullName', this.value); updateButtonState()">
                    <span class="error-message" id="error-fullName">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Признавались ли вы ранее несостоятельным (банкротом)?</label>
                    <span class="question-hint">Речь идёт о завершённой процедуре банкротства, включая судебную процедуру или внесудебное банкротство через МФЦ.</span>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="wasBankrupt-yes" name="wasBankrupt" value="yes" ${anketaData.answers.step1_general.wasBankrupt === true ? 'checked' : ''} onchange="updateData('step1_general', 'wasBankrupt', true); renderCurrentStep()">
                            <label for="wasBankrupt-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="wasBankrupt-no" name="wasBankrupt" value="no" ${anketaData.answers.step1_general.wasBankrupt === false ? 'checked' : ''} onchange="updateData('step1_general', 'wasBankrupt', false); renderCurrentStep()">
                            <label for="wasBankrupt-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-wasBankrupt">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step1_general.wasBankrupt === true ? `
                    <div class="question-block">
                        <label class="question-label">В каком году вы были признаны банкротом?</label>
                        <input type="number" id="bankruptYear" value="${anketaData.answers.step1_general.bankruptYear || ''}" oninput="updateData('step1_general', 'bankruptYear', parseInt(this.value) || null); updateButtonState()">
                        <span class="error-message" id="error-bankruptYear">Пожалуйста, заполните поле</span>
                    </div>

                    <div class="question-block">
                        <label class="question-label">В каком порядке проходила процедура банкротства?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="bankruptType-court" name="bankruptType" value="court" ${anketaData.answers.step1_general.bankruptType === 'court' ? 'checked' : ''} onchange="updateData('step1_general', 'bankruptType', 'court'); updateButtonState()">
                                <label for="bankruptType-court">Судебная процедура</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="bankruptType-mfc" name="bankruptType" value="mfc" ${anketaData.answers.step1_general.bankruptType === 'mfc' ? 'checked' : ''} onchange="updateData('step1_general', 'bankruptType', 'mfc'); updateButtonState()">
                                <label for="bankruptType-mfc">Внесудебное банкротство через МФЦ</label>
                            </div>
                        </div>
                        <span class="error-message" id="error-bankruptType">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep2() {
            const showMarriageQuestions = anketaData.answers.step2_family.isMarried === true || 
                (anketaData.answers.step2_family.isMarried === false && anketaData.answers.step2_family.wasMarriedLast3Years === true);
            
            return `
                <h1>Семейное положение</h1>
                <p class="step-description">Укажите сведения о семейном положении. Данная информация необходима для оценки имущественных отношений и возможных правовых последствий при рассмотрении дела о банкротстве.</p>
                
                <div class="question-block">
                    <label class="question-label">Состоите ли вы в зарегистрированном браке на настоящий момент?</label>
                    <span class="question-hint">Учитывается зарегистрированный брак на дату заполнения анкеты.</span>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="isMarried-yes" name="isMarried" value="yes" ${anketaData.answers.step2_family.isMarried === true ? 'checked' : ''} onchange="updateData('step2_family', 'isMarried', true); clearConditionalFields('step2_family', ['wasMarriedLast3Years']); renderCurrentStep()">
                            <label for="isMarried-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="isMarried-no" name="isMarried" value="no" ${anketaData.answers.step2_family.isMarried === false ? 'checked' : ''} onchange="updateData('step2_family', 'isMarried', false); renderCurrentStep()">
                            <label for="isMarried-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-isMarried">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step2_family.isMarried === false ? `
                    <div class="question-block">
                        <label class="question-label">Состояли ли вы в зарегистрированном браке в течение последних 3 лет?</label>
                        <span class="question-hint">Укажите, если брак был расторгнут в течение последних трёх лет.</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="wasMarriedLast3Years-yes" name="wasMarriedLast3Years" value="yes" ${anketaData.answers.step2_family.wasMarriedLast3Years === true ? 'checked' : ''} onchange="updateData('step2_family', 'wasMarriedLast3Years', true); renderCurrentStep()">
                                <label for="wasMarriedLast3Years-yes">Да</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="wasMarriedLast3Years-no" name="wasMarriedLast3Years" value="no" ${anketaData.answers.step2_family.wasMarriedLast3Years === false ? 'checked' : ''} onchange="updateData('step2_family', 'wasMarriedLast3Years', false); clearConditionalFields('step2_family', ['spouseTransactions', 'spouseTransactionTypes', 'spouseProperty']); renderCurrentStep()">
                                <label for="wasMarriedLast3Years-no">Нет</label>
                            </div>
                        </div>
                        <span class="error-message" id="error-wasMarriedLast3Years">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}

                ${showMarriageQuestions ? `
                    <div class="question-block">
                        <label class="question-label">Совершал ли ваш супруг (или бывший супруг) сделки с имуществом за последние 3 года?</label>
                        <span class="question-hint">Под сделками понимается отчуждение, приобретение или иное распоряжение имуществом.</span>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="spouseTransactions-yes" name="spouseTransactions" value="yes" ${anketaData.answers.step2_family.spouseTransactions === true ? 'checked' : ''} onchange="updateData('step2_family', 'spouseTransactions', true); renderCurrentStep()">
                                <label for="spouseTransactions-yes">Да</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="spouseTransactions-no" name="spouseTransactions" value="no" ${anketaData.answers.step2_family.spouseTransactions === false ? 'checked' : ''} onchange="updateData('step2_family', 'spouseTransactions', false); clearConditionalFields('step2_family', ['spouseTransactionTypes']); renderCurrentStep()">
                                <label for="spouseTransactions-no">Нет</label>
                            </div>
                        </div>
                        <span class="error-message" id="error-spouseTransactions">Пожалуйста, заполните поле</span>
                    </div>

                    ${anketaData.answers.step2_family.spouseTransactions === true ? `
                        <div class="question-block">
                            <label class="question-label">Укажите вид имущества, в отношении которого совершались сделки</label>
                            <span class="question-hint">Можно выбрать один или несколько вариантов.</span>
                            <div class="checkbox-group">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="spouseTransType-realty" value="Недвижимое имущество" ${anketaData.answers.step2_family.spouseTransactionTypes.includes('Недвижимое имущество') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseTransactionTypes', this.value, this.checked)">
                                    <label for="spouseTransType-realty">Недвижимое имущество</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="spouseTransType-vehicles" value="Транспортные средства" ${anketaData.answers.step2_family.spouseTransactionTypes.includes('Транспортные средства') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseTransactionTypes', this.value, this.checked)">
                                    <label for="spouseTransType-vehicles">Транспортные средства</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="spouseTransType-other" value="Иное имущество" ${anketaData.answers.step2_family.spouseTransactionTypes.includes('Иное имущество') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseTransactionTypes', this.value, this.checked)">
                                    <label for="spouseTransType-other">Иное имущество</label>
                                </div>
                            </div>
                            <span class="error-message" id="error-spouseTransactionTypes">Пожалуйста, заполните поле</span>
                        </div>
                    ` : ''}

                    <div class="question-block">
                        <label class="question-label">Какое имущество, приобретённое в период брака, имеется у вашего супруга (или бывшего супруга)?</label>
                        <span class="question-hint">Укажите имущество, независимо от того, на кого оно было оформлено.</span>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="spouseProp-none" value="Нет имущества" ${anketaData.answers.step2_family.spouseProperty.includes('Нет имущества') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseProperty', this.value, this.checked)">
                                <label for="spouseProp-none">Нет имущества</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="spouseProp-realty" value="Недвижимость" ${anketaData.answers.step2_family.spouseProperty.includes('Недвижимость') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseProperty', this.value, this.checked)">
                                <label for="spouseProp-realty">Недвижимость</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="spouseProp-vehicles" value="Транспортные средства" ${anketaData.answers.step2_family.spouseProperty.includes('Транспортные средства') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseProperty', this.value, this.checked)">
                                <label for="spouseProp-vehicles">Транспортные средства</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="spouseProp-shares" value="Доли в имуществе" ${anketaData.answers.step2_family.spouseProperty.includes('Доли в имуществе') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseProperty', this.value, this.checked)">
                                <label for="spouseProp-shares">Доли в имуществе</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="spouseProp-other" value="Иное имущество" ${anketaData.answers.step2_family.spouseProperty.includes('Иное имущество') ? 'checked' : ''} onchange="updateCheckbox('step2_family', 'spouseProperty', this.value, this.checked)">
                                <label for="spouseProp-other">Иное имущество</label>
                            </div>
                        </div>
                        <span class="error-message" id="error-spouseProperty">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep3() {
            return `
                <h1>Несовершеннолетние дети</h1>
                <p class="step-description">Укажите сведения о наличии несовершеннолетних детей. Данная информация учитывается при определении размера обязательных расходов и оценке финансовой нагрузки.</p>
                
                <div class="question-block">
                    <label class="question-label">Имеются ли у вас несовершеннолетние дети?</label>
                    <span class="question-hint">Учитываются дети, не достигшие 18 лет, независимо от места их проживания.</span>
                    <select id="childrenCount" onchange="updateData('step3_children', 'childrenCount', this.value); clearConditionalFields('step3_children', ['monthlyExpenses']); renderCurrentStep()">
                        <option value="">Выберите</option>
                        <option value="Детей нет" ${anketaData.answers.step3_children.childrenCount === 'Детей нет' ? 'selected' : ''}>Детей нет</option>
                        <option value="1" ${anketaData.answers.step3_children.childrenCount === '1' ? 'selected' : ''}>1</option>
                        <option value="2" ${anketaData.answers.step3_children.childrenCount === '2' ? 'selected' : ''}>2</option>
                        <option value="3" ${anketaData.answers.step3_children.childrenCount === '3' ? 'selected' : ''}>3</option>
                        <option value="4" ${anketaData.answers.step3_children.childrenCount === '4' ? 'selected' : ''}>4</option>
                        <option value="5" ${anketaData.answers.step3_children.childrenCount === '5' ? 'selected' : ''}>5</option>
                    </select>
                    <span class="error-message" id="error-childrenCount">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step3_children.childrenCount && anketaData.answers.step3_children.childrenCount !== 'Детей нет' ? `
                    <div class="question-block">
                        <label class="question-label">Укажите ежемесячные расходы на содержание несовершеннолетних детей</label>
                        <span class="question-hint">Укажите среднюю сумму ежемесячных расходов на содержание несовершеннолетних детей.</span>
                        <input type="number" id="monthlyExpenses" value="${anketaData.answers.step3_children.monthlyExpenses || ''}" oninput="updateData('step3_children', 'monthlyExpenses', parseInt(this.value) || null); updateButtonState()">
                        <span class="error-message" id="error-monthlyExpenses">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep4() {
            return `
                <h1>Долги и обязательства</h1>
                <p class="step-description">Укажите сведения о размере и характере имеющейся задолженности. Эта информация необходима для оценки возможности применения процедуры банкротства и определения её формата.</p>
                
                <div class="question-block">
                    <label class="question-label">Сумма всех долгов</label>
                    <span class="question-hint">Укажите общую сумму всех имеющихся долгов (в рублях).</span>
                    <input type="number" id="totalDebt" value="${anketaData.answers.step4_debts.totalDebt || ''}" oninput="updateData('step4_debts', 'totalDebt', parseInt(this.value) || null); updateButtonState()">
                    <span class="error-message" id="error-totalDebt">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Имеются ли у вас долги, которые не подлежат списанию при банкротстве?</label>
                    <span class="question-hint">К таким долгам относятся отдельные категории обязательств, установленные законом.</span>
                    <select id="nonDischargeable" onchange="updateData('step4_debts', 'nonDischargeable', this.value); updateButtonState()">
                        <option value="">Выберите</option>
                        <option value="Нет" ${anketaData.answers.step4_debts.nonDischargeable === 'Нет' ? 'selected' : ''}>Нет</option>
                        <option value="Алименты" ${anketaData.answers.step4_debts.nonDischargeable === 'Алименты' ? 'selected' : ''}>Алименты</option>
                        <option value="Возмещение вреда жизни и здоровью" ${anketaData.answers.step4_debts.nonDischargeable === 'Возмещение вреда жизни и здоровью' ? 'selected' : ''}>Возмещение вреда жизни и здоровью</option>
                        <option value="Обязательства по приговору суда" ${anketaData.answers.step4_debts.nonDischargeable === 'Обязательства по приговору суда' ? 'selected' : ''}>Обязательства по приговору суда</option>
                        <option value="Несколько из перечисленных" ${anketaData.answers.step4_debts.nonDischargeable === 'Несколько из перечисленных' ? 'selected' : ''}>Несколько из перечисленных</option>
                    </select>
                    <span class="error-message" id="error-nonDischargeable">Пожалуйста, заполните поле</span>
                </div>
            `;
        }

        function renderStep5() {
            return `
                <h1>Кредиты и займы</h1>
                <p class="step-description">Укажите кредитные организации, в которых у вас имеются кредиты или займы. Информация используется для уточнения структуры задолженности и последующего анализа кредитной истории.</p>
                
                <div class="question-block">
                    <label class="question-label">Выберите банки, в которых у вас имеются кредиты (займы)</label>
                    <span class="question-hint">Можно выбрать один или несколько банков. Укажите кредитные организации, в которых у вас имеются кредитные обязательства.</span>
                    <div class="checkbox-group">
                        ${banks.map((bank, idx) => `
                            <div class="checkbox-option">
                                <input type="checkbox" id="bank-${idx}" value="${bank}" ${anketaData.answers.step5_banks.selectedBanks.includes(bank) ? 'checked' : ''} onchange="updateCheckbox('step5_banks', 'selectedBanks', this.value, this.checked); renderCurrentStep()">
                                <label for="bank-${idx}">${bank}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-selectedBanks">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step5_banks.selectedBanks.includes('Другой банк') ? `
                    <div class="question-block">
                        <label class="question-label">Укажите наименование кредитной организации</label>
                        <input type="text" id="otherBankName" value="${anketaData.answers.step5_banks.otherBankName}" oninput="updateData('step5_banks', 'otherBankName', this.value); updateButtonState()">
                        <span class="error-message" id="error-otherBankName">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep6() {
            const selectedBanks = anketaData.answers.step5_banks.selectedBanks;
            
            return `
                <h1>Сведения о кредитах</h1>
                <p class="step-description">Укажите сведения о кредитах и займах в выбранных кредитных организациях. Информация используется для анализа давности обязательств и оценки добросовестности заёмщика.</p>
                
                ${selectedBanks.map(bank => {
                    if (!anketaData.answers.step6_bankCredits[bank]) {
                        anketaData.answers.step6_bankCredits[bank] = {
                            count: null,
                            credits: []
                        };
                    }
                    
                    const bankData = anketaData.answers.step6_bankCredits[bank];
                    const creditCount = bankData.count || 0;
                    
                    return `
                        <div class="bank-block">
                            <h3>${bank}</h3>
                            
                            <div class="question-block">
                                <label class="question-label">Укажите количество кредитов (займов) в данном банке</label>
                                <select id="bankCount-${bank}" onchange="updateBankCreditCount('${bank}', parseInt(this.value))">
                                    <option value="">Выберите</option>
                                    ${[1,2,3,4,5].map(n => `<option value="${n}" ${bankData.count === n ? 'selected' : ''}>${n}</option>`).join('')}
                                </select>
                                <span class="error-message" id="error-bankCount-${bank}">Пожалуйста, заполните поле</span>
                            </div>

                            ${creditCount > 0 ? Array.from({length: creditCount}, (_, i) => {
                                if (!bankData.credits[i]) {
                                    bankData.credits[i] = {
                                        amount: null,
                                        monthsAgo: null,
                                        paymentsCount: null
                                    };
                                }
                                const credit = bankData.credits[i];
                                
                                return `
                                    <div class="credit-block">
                                        <h4>Кредит №${i + 1}</h4>
                                        
                                        <div class="question-block">
                                            <label class="question-label">Сумма кредита (займа)</label>
                                            <input type="number" id="credit-${bank}-${i}-amount" value="${credit.amount || ''}" oninput="updateBankCredit('${bank}', ${i}, 'amount', parseInt(this.value) || null); updateButtonState()">
                                            <span class="error-message" id="error-credit-${bank}-${i}-amount">Пожалуйста, заполните поле</span>
                                        </div>
                                        
                                        <div class="question-block">
                                            <label class="question-label">Сколько месяцев назад был взят кредит</label>
                                            <span class="question-hint">Укажите количество месяцев, прошедших с момента получения кредита.</span>
                                            <input type="number" id="credit-${bank}-${i}-monthsAgo" value="${credit.monthsAgo !== null ? credit.monthsAgo : ''}" oninput="updateBankCredit('${bank}', ${i}, 'monthsAgo', parseInt(this.value) || 0); updateButtonState()">
                                            <span class="error-message" id="error-credit-${bank}-${i}-monthsAgo">Пожалуйста, заполните поле</span>
                                        </div>
                                        
                                        <div class="question-block">
                                            <label class="question-label">Количество внесённых платежей по кредиту</label>
                                            <input type="number" id="credit-${bank}-${i}-paymentsCount" value="${credit.paymentsCount !== null ? credit.paymentsCount : ''}" oninput="updateBankCredit('${bank}', ${i}, 'paymentsCount', parseInt(this.value) || 0); updateButtonState()">
                                            <span class="error-message" id="error-credit-${bank}-${i}-paymentsCount">Пожалуйста, заполните поле</span>
                                        </div>
                                    </div>
                                `;
                            }).join('') : ''}
                        </div>
                    `;
                }).join('')}
            `;
        }

        function updateBankCreditCount(bank, count) {
            anketaData.answers.step6_bankCredits[bank].count = count;
            
            if (anketaData.answers.step6_bankCredits[bank].credits.length > count) {
                anketaData.answers.step6_bankCredits[bank].credits = anketaData.answers.step6_bankCredits[bank].credits.slice(0, count);
            }
            
            renderCurrentStep();
        }

        function updateBankCredit(bank, index, field, value) {
            if (!anketaData.answers.step6_bankCredits[bank].credits[index]) {
                anketaData.answers.step6_bankCredits[bank].credits[index] = {};
            }
            anketaData.answers.step6_bankCredits[bank].credits[index][field] = value;
        }

        function renderStep7() {
            return `
                <h1>Задолженность перед микрофинансовыми организациями</h1>
                <p class="step-description">Укажите сведения о займах, полученных в микрофинансовых (микрокредитных) организациях. Данная информация используется для оценки структуры задолженности и финансовой нагрузки.</p>
                
                <div class="question-block">
                    <label class="question-label">Имеется ли у вас задолженность перед микрофинансовыми организациями (МФО)?</label>
                    <span class="question-hint">Укажите количество микрофинансовых (микрокредитных) организаций, в которых вы брали займы за последние 6 месяцев.</span>
                    <input type="number" id="mfoCount" value="${anketaData.answers.step7_mfo.mfoCount !== null ? anketaData.answers.step7_mfo.mfoCount : ''}" oninput="updateData('step7_mfo', 'mfoCount', parseInt(this.value) || 0); clearConditionalFields('step7_mfo', ['mfoTotalDebt']); renderCurrentStep()">
                    <span class="error-message" id="error-mfoCount">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step7_mfo.mfoCount > 0 ? `
                    <div class="question-block">
                        <label class="question-label">Какая общая задолженность перед микрофинансовыми организациями?</label>
                        <span class="question-hint">Укажите примерную общую сумму задолженности перед микрофинансовыми организациями за последние 6 месяцев.</span>
                        <input type="number" id="mfoTotalDebt" placeholder="120 000" value="${anketaData.answers.step7_mfo.mfoTotalDebt !== null ? anketaData.answers.step7_mfo.mfoTotalDebt : ''}" oninput="updateData('step7_mfo', 'mfoTotalDebt', parseInt(this.value) || 0); updateButtonState()">
                        <span class="error-message" id="error-mfoTotalDebt">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep8() {
            return `
                <h1>Расходование кредитных средств</h1>
                <p class="step-description">Укажите, на какие цели были направлены кредитные средства. Информация используется для анализа характера расходов и общего понимания финансовой ситуации.</p>
                
                <div class="question-block">
                    <label class="question-label">На какие цели в основном расходовались кредитные средства?</label>
                    <span class="question-hint">Можно выбрать один или несколько вариантов. Указывайте те цели, которые наиболее соответствуют вашей ситуации.</span>
                    <div class="checkbox-group">
                        ${[
                            'Погашение ранее взятых кредитов и займов',
                            'Повседневные расходы (питание, одежда, бытовые нужды)',
                            'Оплата жилья и коммунальных услуг',
                            'Медицинские расходы',
                            'Расходы на детей',
                            'Ремонт жилья',
                            'Покупка товаров длительного пользования',
                            'Ведение предпринимательской деятельности / самозанятость',
                            'Иные цели'
                        ].map((purpose, idx) => `
                            <div class="checkbox-option">
                                <input type="checkbox" id="purpose-${idx}" value="${purpose}" ${anketaData.answers.step8_spending.purposes.includes(purpose) ? 'checked' : ''} onchange="updateCheckbox('step8_spending', 'purposes', this.value, this.checked); renderCurrentStep()">
                                <label for="purpose-${idx}">${purpose}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-purposes">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step8_spending.purposes.includes('Иные цели') ? `
                    <div class="question-block">
                        <label class="question-label">Уточните, на какие иные цели были направлены кредитные средства</label>
                        <input type="text" id="otherPurpose" value="${anketaData.answers.step8_spending.otherPurpose}" oninput="updateData('step8_spending', 'otherPurpose', this.value); updateButtonState()">
                        <span class="error-message" id="error-otherPurpose">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}

                <div class="question-block">
                    <label class="question-label">Были ли за счёт кредитных средств совершены крупные разовые расходы?</label>
                    <div class="radio-group">
                        ${[
                            {value: 'Нет', label: 'Нет'},
                            {value: 'Да, на необходимые нужды', label: 'Да, на необходимые нужды'},
                            {value: 'Да, на приобретение имущества', label: 'Да, на приобретение имущества'},
                            {value: 'Затрудняюсь ответить', label: 'Затрудняюсь ответить'}
                        ].map((opt, idx) => `
                            <div class="radio-option">
                                <input type="radio" id="largePurchases-${idx}" name="largePurchases" value="${opt.value}" ${anketaData.answers.step8_spending.largePurchases === opt.value ? 'checked' : ''} onchange="updateData('step8_spending', 'largePurchases', this.value); updateButtonState()">
                                <label for="largePurchases-${idx}">${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-largePurchases">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Приобреталось ли за счёт кредитных средств имущество и сохранилось ли оно на настоящий момент?</label>
                    <div class="radio-group">
                        ${[
                            {value: 'Нет', label: 'Нет'},
                            {value: 'Да, имущество сохранилось', label: 'Да, имущество сохранилось'},
                            {value: 'Да, имущество утрачено или реализовано', label: 'Да, имущество утрачено или реализовано'},
                            {value: 'Затрудняюсь ответить', label: 'Затрудняюсь ответить'}
                        ].map((opt, idx) => `
                            <div class="radio-option">
                                <input type="radio" id="propertyPurchased-${idx}" name="propertyPurchased" value="${opt.value}" ${anketaData.answers.step8_spending.propertyPurchased === opt.value ? 'checked' : ''} onchange="updateData('step8_spending', 'propertyPurchased', this.value); clearConditionalFields('step8_spending', ['propertyType']); renderCurrentStep()">
                                <label for="propertyPurchased-${idx}">${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-propertyPurchased">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step8_spending.propertyPurchased && anketaData.answers.step8_spending.propertyPurchased.startsWith('Да') ? `
                    <div class="question-block">
                        <label class="question-label">Укажите вид имущества</label>
                        <div class="radio-group">
                            ${[
                                {value: 'Недвижимое имущество', label: 'Недвижимое имущество'},
                                {value: 'Транспортные средства', label: 'Транспортные средства'},
                                {value: 'Иное движимое имущество', label: 'Иное движимое имущество'}
                            ].map((opt, idx) => `
                                <div class="radio-option">
                                    <input type="radio" id="propertyType-${idx}" name="propertyType" value="${opt.value}" ${anketaData.answers.step8_spending.propertyType === opt.value ? 'checked' : ''} onchange="updateData('step8_spending', 'propertyType', this.value); updateButtonState()">
                                    <label for="propertyType-${idx}">${opt.label}</label>
                                </div>
                            `).join('')}
                        </div>
                        <span class="error-message" id="error-propertyType">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}

                <div class="question-block">
                    <label class="question-label">Перечислялись ли кредитные средства третьим лицам?</label>
                    <div class="radio-group">
                        ${[
                            {value: 'Нет', label: 'Нет'},
                            {value: 'Да, для погашения обязательств', label: 'Да, для погашения обязательств'},
                            {value: 'Да, в качестве помощи родственникам', label: 'Да, в качестве помощи родственникам'},
                            {value: 'Затрудняюсь ответить', label: 'Затрудняюсь ответить'}
                        ].map((opt, idx) => `
                            <div class="radio-option">
                                <input type="radio" id="transfersToThirdParties-${idx}" name="transfersToThirdParties" value="${opt.value}" ${anketaData.answers.step8_spending.transfersToThirdParties === opt.value ? 'checked' : ''} onchange="updateData('step8_spending', 'transfersToThirdParties', this.value); updateButtonState()">
                                <label for="transfersToThirdParties-${idx}">${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-transfersToThirdParties">Пожалуйста, заполните поле</span>
                </div>
            `;
        }

        function renderStep9() {
            return `
                <h1>Доходы</h1>
                <p class="step-description">Укажите сведения о ваших доходах. Информация используется для оценки текущего финансового положения и возможности исполнения обязательств.</p>
                
                <div class="question-block">
                    <label class="question-label">Укажите общий размер вашего ежемесячного дохода</label>
                    <input type="number" id="monthlyIncome" value="${anketaData.answers.step9_income.monthlyIncome !== null ? anketaData.answers.step9_income.monthlyIncome : ''}" oninput="updateData('step9_income', 'monthlyIncome', parseInt(this.value) || 0); updateButtonState()">
                    <span class="error-message" id="error-monthlyIncome">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Имеется ли у вас официальное место работы?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="hasOfficialJob-yes" name="hasOfficialJob" value="yes" ${anketaData.answers.step9_income.hasOfficialJob === true ? 'checked' : ''} onchange="updateData('step9_income', 'hasOfficialJob', true); updateButtonState()">
                            <label for="hasOfficialJob-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="hasOfficialJob-no" name="hasOfficialJob" value="no" ${anketaData.answers.step9_income.hasOfficialJob === false ? 'checked' : ''} onchange="updateData('step9_income', 'hasOfficialJob', false); updateButtonState()">
                            <label for="hasOfficialJob-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-hasOfficialJob">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Получаете ли вы доход от самозанятости или по договорам оказания услуг (выполнения работ)?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="hasSelfEmployment-yes" name="hasSelfEmployment" value="yes" ${anketaData.answers.step9_income.hasSelfEmployment === true ? 'checked' : ''} onchange="updateData('step9_income', 'hasSelfEmployment', true); updateButtonState()">
                            <label for="hasSelfEmployment-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="hasSelfEmployment-no" name="hasSelfEmployment" value="no" ${anketaData.answers.step9_income.hasSelfEmployment === false ? 'checked' : ''} onchange="updateData('step9_income', 'hasSelfEmployment', false); updateButtonState()">
                            <label for="hasSelfEmployment-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-hasSelfEmployment">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Имеются ли у вас иные источники дохода?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="hasOtherIncome-yes" name="hasOtherIncome" value="yes" ${anketaData.answers.step9_income.hasOtherIncome === true ? 'checked' : ''} onchange="updateData('step9_income', 'hasOtherIncome', true); updateButtonState()">
                            <label for="hasOtherIncome-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="hasOtherIncome-no" name="hasOtherIncome" value="no" ${anketaData.answers.step9_income.hasOtherIncome === false ? 'checked' : ''} onchange="updateData('step9_income', 'hasOtherIncome', false); updateButtonState()">
                            <label for="hasOtherIncome-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-hasOtherIncome">Пожалуйста, заполните поле</span>
                </div>
            `;
        }

        function renderStep10() {
            return `
                <h1>Расходы и исполнение обязательств</h1>
                <p class="step-description">Укажите сведения о ваших регулярных расходах, а также об исполнении кредитных обязательств. Информация используется для оценки финансового положения и анализа поведения заёмщика.</p>
                
                <h2>Регулярные расходы</h2>
                
                <div class="question-block">
                    <label class="question-label">Алименты (руб)</label>
                    <input type="number" id="alimony" value="${anketaData.answers.step10_expensesAndBehavior.alimony !== null ? anketaData.answers.step10_expensesAndBehavior.alimony : ''}" oninput="updateData('step10_expensesAndBehavior', 'alimony', parseInt(this.value) || 0); updateButtonState()">
                    <span class="error-message" id="error-alimony">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Коммунальные платежи (руб)</label>
                    <input type="number" id="utilities" value="${anketaData.answers.step10_expensesAndBehavior.utilities !== null ? anketaData.answers.step10_expensesAndBehavior.utilities : ''}" oninput="updateData('step10_expensesAndBehavior', 'utilities', parseInt(this.value) || 0); updateButtonState()">
                    <span class="error-message" id="error-utilities">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Аренда жилья (руб)</label>
                    <input type="number" id="rent" value="${anketaData.answers.step10_expensesAndBehavior.rent !== null ? anketaData.answers.step10_expensesAndBehavior.rent : ''}" oninput="updateData('step10_expensesAndBehavior', 'rent', parseInt(this.value) || 0); updateButtonState()">
                    <span class="error-message" id="error-rent">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Иные регулярные расходы (руб)</label>
                    <input type="number" id="otherExpenses" value="${anketaData.answers.step10_expensesAndBehavior.otherExpenses !== null ? anketaData.answers.step10_expensesAndBehavior.otherExpenses : ''}" oninput="updateData('step10_expensesAndBehavior', 'otherExpenses', parseInt(this.value) || 0); updateButtonState()">
                    <span class="error-message" id="error-otherExpenses">Пожалуйста, заполните поле</span>
                </div>

                <h2>Просрочки и действия по кредитам</h2>

                <div class="question-block">
                    <label class="question-label">Имеются ли у вас просрочки по кредитным обязательствам?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="hasOverdue-yes" name="hasOverdue" value="yes" ${anketaData.answers.step10_expensesAndBehavior.hasOverdue === true ? 'checked' : ''} onchange="updateData('step10_expensesAndBehavior', 'hasOverdue', true); renderCurrentStep()">
                            <label for="hasOverdue-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="hasOverdue-no" name="hasOverdue" value="no" ${anketaData.answers.step10_expensesAndBehavior.hasOverdue === false ? 'checked' : ''} onchange="updateData('step10_expensesAndBehavior', 'hasOverdue', false); clearConditionalFields('step10_expensesAndBehavior', ['maxOverduePeriod']); renderCurrentStep()">
                            <label for="hasOverdue-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-hasOverdue">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step10_expensesAndBehavior.hasOverdue === true ? `
                    <div class="question-block">
                        <label class="question-label">Каков срок наибольшей просрочки по кредитам?</label>
                        <select id="maxOverduePeriod" onchange="updateData('step10_expensesAndBehavior', 'maxOverduePeriod', this.value); updateButtonState()">
                            <option value="">Выберите</option>
                            <option value="До 30 дней" ${anketaData.answers.step10_expensesAndBehavior.maxOverduePeriod === 'До 30 дней' ? 'selected' : ''}>До 30 дней</option>
                            <option value="От 31 до 90 дней" ${anketaData.answers.step10_expensesAndBehavior.maxOverduePeriod === 'От 31 до 90 дней' ? 'selected' : ''}>От 31 до 90 дней</option>
                            <option value="Более 90 дней" ${anketaData.answers.step10_expensesAndBehavior.maxOverduePeriod === 'Более 90 дней' ? 'selected' : ''}>Более 90 дней</option>
                            <option value="Затрудняюсь ответить" ${anketaData.answers.step10_expensesAndBehavior.maxOverduePeriod === 'Затрудняюсь ответить' ? 'selected' : ''}>Затрудняюсь ответить</option>
                        </select>
                        <span class="error-message" id="error-maxOverduePeriod">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}

                <div class="question-block">
                    <label class="question-label">Обращались ли вы в кредитные организации с заявлением о реструктуризации задолженности?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="requestedRestructuring-yes" name="requestedRestructuring" value="yes" ${anketaData.answers.step10_expensesAndBehavior.requestedRestructuring === true ? 'checked' : ''} onchange="updateData('step10_expensesAndBehavior', 'requestedRestructuring', true); renderCurrentStep()">
                            <label for="requestedRestructuring-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="requestedRestructuring-no" name="requestedRestructuring" value="no" ${anketaData.answers.step10_expensesAndBehavior.requestedRestructuring === false ? 'checked' : ''} onchange="updateData('step10_expensesAndBehavior', 'requestedRestructuring', false); clearConditionalFields('step10_expensesAndBehavior', ['restructuringWhen']); renderCurrentStep()">
                            <label for="requestedRestructuring-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-requestedRestructuring">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step10_expensesAndBehavior.requestedRestructuring === true ? `
                    <div class="question-block">
                        <label class="question-label">Когда вы обращались за реструктуризацией?</label>
                        <select id="restructuringWhen" onchange="updateData('step10_expensesAndBehavior', 'restructuringWhen', this.value); updateButtonState()">
                            <option value="">Выберите</option>
                            <option value="Менее 3 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.restructuringWhen === 'Менее 3 месяцев назад' ? 'selected' : ''}>Менее 3 месяцев назад</option>
                            <option value="От 3 до 6 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.restructuringWhen === 'От 3 до 6 месяцев назад' ? 'selected' : ''}>От 3 до 6 месяцев назад</option>
                            <option value="Более 6 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.restructuringWhen === 'Более 6 месяцев назад' ? 'selected' : ''}>Более 6 месяцев назад</option>
                        </select>
                        <span class="error-message" id="error-restructuringWhen">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}

                <div class="question-block">
                    <label class="question-label">Получали ли вы новые кредиты или займы после возникновения финансовых трудностей?</label>
                    <div class="radio-group">
                        ${[
                            {value: 'Да', label: 'Да'},
                            {value: 'Нет', label: 'Нет'},
                            {value: 'Затрудняюсь ответить', label: 'Затрудняюсь ответить'}
                        ].map((opt, idx) => `
                            <div class="radio-option">
                                <input type="radio" id="newCreditsAfterTrouble-${idx}" name="newCreditsAfterTrouble" value="${opt.value}" ${anketaData.answers.step10_expensesAndBehavior.newCreditsAfterTrouble === opt.value ? 'checked' : ''} onchange="updateData('step10_expensesAndBehavior', 'newCreditsAfterTrouble', this.value); clearConditionalFields('step10_expensesAndBehavior', ['newCreditsWhen']); renderCurrentStep()">
                                <label for="newCreditsAfterTrouble-${idx}">${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    <span class="error-message" id="error-newCreditsAfterTrouble">Пожалуйста, заполните поле</span>
                </div>

                ${anketaData.answers.step10_expensesAndBehavior.newCreditsAfterTrouble === 'Да' ? `
                    <div class="question-block">
                        <label class="question-label">Сколько времени прошло с момента получения новых кредитов?</label>
                        <select id="newCreditsWhen" onchange="updateData('step10_expensesAndBehavior', 'newCreditsWhen', this.value); updateButtonState()">
                            <option value="">Выберите</option>
                            <option value="Менее 3 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.newCreditsWhen === 'Менее 3 месяцев назад' ? 'selected' : ''}>Менее 3 месяцев назад</option>
                            <option value="От 3 до 6 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.newCreditsWhen === 'От 3 до 6 месяцев назад' ? 'selected' : ''}>От 3 до 6 месяцев назад</option>
                            <option value="От 6 до 12 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.newCreditsWhen === 'От 6 до 12 месяцев назад' ? 'selected' : ''}>От 6 до 12 месяцев назад</option>
                            <option value="Более 12 месяцев назад" ${anketaData.answers.step10_expensesAndBehavior.newCreditsWhen === 'Более 12 месяцев назад' ? 'selected' : ''}>Более 12 месяцев назад</option>
                        </select>
                        <span class="error-message" id="error-newCreditsWhen">Пожалуйста, заполните поле</span>
                    </div>
                ` : ''}
            `;
        }

        function renderStep11() {
            return `
                <h1>Имущество</h1>
                <p class="step-description">Укажите сведения о принадлежащем вам имуществе. Информация используется для определения состава имущества и оценки возможных последствий процедуры банкротства.</p>
                
                ${[
                    {id: 'onlyHome', label: 'Единственное жильё'},
                    {id: 'propertyShares', label: 'Доли в праве собственности на недвижимость'},
                    {id: 'mortgageContracts', label: 'Действующие ипотечные договоры'},
                    {id: 'collateralProperty', label: 'Залоговое имущество (кроме ипотеки)'},
                    {id: 'financialAssets', label: 'Вклады/ценные бумаги/финансовые активы'},
                    {id: 'vehicles', label: 'Транспортные средства'},
                    {id: 'otherProperty', label: 'Иное имущество'}
                ].map(prop => `
                    <div class="question-block">
                        <label class="question-label">${prop.label}</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="${prop.id}-yes" name="${prop.id}" value="yes" ${anketaData.answers.step11_property[prop.id] === true ? 'checked' : ''} onchange="updateData('step11_property', '${prop.id}', true); updateButtonState()">
                                <label for="${prop.id}-yes">Да</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="${prop.id}-no" name="${prop.id}" value="no" ${anketaData.answers.step11_property[prop.id] === false ? 'checked' : ''} onchange="updateData('step11_property', '${prop.id}', false); updateButtonState()">
                                <label for="${prop.id}-no">Нет</label>
                            </div>
                        </div>
                        <span class="error-message" id="error-${prop.id}">Пожалуйста, заполните поле</span>
                    </div>
                `).join('')}
            `;
        }

        function renderStep12() {
            return `
                <h1>Правовые обстоятельства</h1>
                <p class="step-description">Укажите сведения о правовых обстоятельствах, которые могут иметь значение при рассмотрении дела о банкротстве. Информация необходима для корректной правовой оценки ситуации.</p>
                
                <div class="question-block">
                    <label class="question-label">Имеется ли решение суда о признании вас недееспособным или ограниченно дееспособным?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="incapacityDecision-yes" name="incapacityDecision" value="yes" ${anketaData.answers.step12_legal.incapacityDecision === true ? 'checked' : ''} onchange="updateData('step12_legal', 'incapacityDecision', true); updateButtonState()">
                            <label for="incapacityDecision-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="incapacityDecision-no" name="incapacityDecision" value="no" ${anketaData.answers.step12_legal.incapacityDecision === false ? 'checked' : ''} onchange="updateData('step12_legal', 'incapacityDecision', false); updateButtonState()">
                            <label for="incapacityDecision-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-incapacityDecision">Пожалуйста, заполните поле</span>
                </div>

                <div class="question-block">
                    <label class="question-label">Привлекались ли вы к уголовной ответственности по преступлениям в сфере кредитования или имущественным преступлениям?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="criminalRecord-yes" name="criminalRecord" value="yes" ${anketaData.answers.step12_legal.criminalRecord === true ? 'checked' : ''} onchange="updateData('step12_legal', 'criminalRecord', true); updateButtonState()">
                            <label for="criminalRecord-yes">Да</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="criminalRecord-no" name="criminalRecord" value="no" ${anketaData.answers.step12_legal.criminalRecord === false ? 'checked' : ''} onchange="updateData('step12_legal', 'criminalRecord', false); updateButtonState()">
                            <label for="criminalRecord-no">Нет</label>
                        </div>
                    </div>
                    <span class="error-message" id="error-criminalRecord">Пожалуйста, заполните поле</span>
                </div>
            `;
        }

        function renderFinalScreen() {
            return `
                <div class="final-screen">
                    <h1>Предварительная оценка сформирована</h1>
                    <p>Спасибо за заполнение анкеты. Предоставленные сведения будут использованы для правового анализа судебной перспективы.</p>
                </div>
            `;
        }

        function updateData(step, field, value) {
            anketaData.answers[step][field] = value;
        }

        function updateCheckbox(step, field, value, checked) {
            if (checked) {
                if (!anketaData.answers[step][field].includes(value)) {
                    anketaData.answers[step][field].push(value);
                }
            } else {
                anketaData.answers[step][field] = anketaData.answers[step][field].filter(v => v !== value);
            }
            updateButtonState();
        }

        function clearConditionalFields(step, fields) {
            fields.forEach(field => {
                const value = anketaData.answers[step][field];
                if (typeof value === 'string') {
                    anketaData.answers[step][field] = "";
                } else if (typeof value === 'number') {
                    anketaData.answers[step][field] = null;
                } else if (Array.isArray(value)) {
                    anketaData.answers[step][field] = [];
                } else {
                    anketaData.answers[step][field] = null;
                }
            });
        }

        function validateStep(step) {
            const errors = [];
            
            switch(step) {
                case 1:
                    if (!anketaData.answers.step1_general.region) errors.push('region');
                    if (!anketaData.answers.step1_general.fullName.trim()) errors.push('fullName');
                    if (anketaData.answers.step1_general.wasBankrupt === null) errors.push('wasBankrupt');
                    if (anketaData.answers.step1_general.wasBankrupt === true) {
                        if (!anketaData.answers.step1_general.bankruptYear) errors.push('bankruptYear');
                        if (!anketaData.answers.step1_general.bankruptType) errors.push('bankruptType');
                    }
                    break;
                    
                case 2:
                    if (anketaData.answers.step2_family.isMarried === null) errors.push('isMarried');
                    if (anketaData.answers.step2_family.isMarried === false && anketaData.answers.step2_family.wasMarriedLast3Years === null) {
                        errors.push('wasMarriedLast3Years');
                    }
                    
                    const showMarriageQuestions = anketaData.answers.step2_family.isMarried === true || 
                        (anketaData.answers.step2_family.isMarried === false && anketaData.answers.step2_family.wasMarriedLast3Years === true);
                    
                    if (showMarriageQuestions) {
                        if (anketaData.answers.step2_family.spouseTransactions === null) errors.push('spouseTransactions');
                        if (anketaData.answers.step2_family.spouseTransactions === true && anketaData.answers.step2_family.spouseTransactionTypes.length === 0) {
                            errors.push('spouseTransactionTypes');
                        }
                        if (anketaData.answers.step2_family.spouseProperty.length === 0) errors.push('spouseProperty');
                    }
                    break;
                    
                case 3:
                    if (!anketaData.answers.step3_children.childrenCount) errors.push('childrenCount');
                    if (anketaData.answers.step3_children.childrenCount && anketaData.answers.step3_children.childrenCount !== 'Детей нет') {
                        if (anketaData.answers.step3_children.monthlyExpenses === null) errors.push('monthlyExpenses');
                    }
                    break;
                    
                case 4:
                    if (anketaData.answers.step4_debts.totalDebt === null) errors.push('totalDebt');
                    if (!anketaData.answers.step4_debts.nonDischargeable) errors.push('nonDischargeable');
                    break;
                    
                case 5:
                    if (anketaData.answers.step5_banks.selectedBanks.length === 0) errors.push('selectedBanks');
                    if (anketaData.answers.step5_banks.selectedBanks.includes('Другой банк') && !anketaData.answers.step5_banks.otherBankName.trim()) {
                        errors.push('otherBankName');
                    }
                    break;
                    
                case 6:
                    anketaData.answers.step5_banks.selectedBanks.forEach(bank => {
                        const bankData = anketaData.answers.step6_bankCredits[bank];
                        if (!bankData || !bankData.count) {
                            errors.push(`bankCount-${bank}`);
                        } else {
                            for (let i = 0; i < bankData.count; i++) {
                                const credit = bankData.credits[i];
                                if (!credit || credit.amount === null) errors.push(`credit-${bank}-${i}-amount`);
                                if (!credit || credit.monthsAgo === null) errors.push(`credit-${bank}-${i}-monthsAgo`);
                                if (!credit || credit.paymentsCount === null) errors.push(`credit-${bank}-${i}-paymentsCount`);
                            }
                        }
                    });
                    break;
                    
                case 7:
                    if (anketaData.answers.step7_mfo.mfoCount === null) errors.push('mfoCount');
                    if (anketaData.answers.step7_mfo.mfoCount > 0 && anketaData.answers.step7_mfo.mfoTotalDebt === null) {
                        errors.push('mfoTotalDebt');
                    }
                    break;
                    
                case 8:
                    if (anketaData.answers.step8_spending.purposes.length === 0) errors.push('purposes');
                    if (anketaData.answers.step8_spending.purposes.includes('Иные цели') && !anketaData.answers.step8_spending.otherPurpose.trim()) {
                        errors.push('otherPurpose');
                    }
                    if (!anketaData.answers.step8_spending.largePurchases) errors.push('largePurchases');
                    if (!anketaData.answers.step8_spending.propertyPurchased) errors.push('propertyPurchased');
                    if (anketaData.answers.step8_spending.propertyPurchased && anketaData.answers.step8_spending.propertyPurchased.startsWith('Да') && !anketaData.answers.step8_spending.propertyType) {
                        errors.push('propertyType');
                    }
                    if (!anketaData.answers.step8_spending.transfersToThirdParties) errors.push('transfersToThirdParties');
                    break;
                    
                case 9:
                    if (anketaData.answers.step9_income.monthlyIncome === null) errors.push('monthlyIncome');
                    if (anketaData.answers.step9_income.hasOfficialJob === null) errors.push('hasOfficialJob');
                    if (anketaData.answers.step9_income.hasSelfEmployment === null) errors.push('hasSelfEmployment');
                    if (anketaData.answers.step9_income.hasOtherIncome === null) errors.push('hasOtherIncome');
                    break;
                    
                case 10:
                    if (anketaData.answers.step10_expensesAndBehavior.alimony === null) errors.push('alimony');
                    if (anketaData.answers.step10_expensesAndBehavior.utilities === null) errors.push('utilities');
                    if (anketaData.answers.step10_expensesAndBehavior.rent === null) errors.push('rent');
                    if (anketaData.answers.step10_expensesAndBehavior.otherExpenses === null) errors.push('otherExpenses');
                    if (anketaData.answers.step10_expensesAndBehavior.hasOverdue === null) errors.push('hasOverdue');
                    if (anketaData.answers.step10_expensesAndBehavior.hasOverdue === true && !anketaData.answers.step10_expensesAndBehavior.maxOverduePeriod) {
                        errors.push('maxOverduePeriod');
                    }
                    if (anketaData.answers.step10_expensesAndBehavior.requestedRestructuring === null) errors.push('requestedRestructuring');
                    if (anketaData.answers.step10_expensesAndBehavior.requestedRestructuring === true && !anketaData.answers.step10_expensesAndBehavior.restructuringWhen) {
                        errors.push('restructuringWhen');
                    }
                    if (!anketaData.answers.step10_expensesAndBehavior.newCreditsAfterTrouble) errors.push('newCreditsAfterTrouble');
                    if (anketaData.answers.step10_expensesAndBehavior.newCreditsAfterTrouble === 'Да' && !anketaData.answers.step10_expensesAndBehavior.newCreditsWhen) {
                        errors.push('newCreditsWhen');
                    }
                    break;
                    
                case 11:
                    ['onlyHome', 'propertyShares', 'mortgageContracts', 'collateralProperty', 'financialAssets', 'vehicles', 'otherProperty'].forEach(prop => {
                        if (anketaData.answers.step11_property[prop] === null) errors.push(prop);
                    });
                    break;
                    
                case 12:
                    if (anketaData.answers.step12_legal.incapacityDecision === null) errors.push('incapacityDecision');
                    if (anketaData.answers.step12_legal.criminalRecord === null) errors.push('criminalRecord');
                    break;
            }
            
            return errors;
        }

        function showErrors(errors) {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            
            errors.forEach(errorId => {
                const errorEl = document.getElementById(`error-${errorId}`);
                if (errorEl) {
                    errorEl.classList.add('show');
                }
            });
        }

        function renderCurrentStep() {
            const app = document.getElementById('app');
            let content = '';
            
            if (currentStep === 13) {
                content = renderFinalScreen();
            } else {
                const stepFunctions = [
                    null, renderStep1, renderStep2, renderStep3, renderStep4, renderStep5,
                    renderStep6, renderStep7, renderStep8, renderStep9, renderStep10,
                    renderStep11, renderStep12
                ];
                
                content = `
                    <div class="step active">
                        ${stepFunctions[currentStep]()}
                        <div class="navigation">
                            ${currentStep > 1 ? '<button class="btn-back" onclick="goBack()">Назад</button>' : '<div></div>'}
                            ${currentStep < 12 ? 
                                '<button class="btn-next" id="btnNext" onclick="goNext()">Далее</button>' :
                                '<button class="btn-finish" id="btnNext" onclick="finishAnketa()">Завершить анкету</button>'
                            }
                        </div>
                    </div>
                `;
            }
            
            app.innerHTML = content;
            
            if (currentStep <= 12) {
                updateButtonState();
            }
        }

        function updateButtonState() {
            const errors = validateStep(currentStep);
            const btnNext = document.getElementById('btnNext');
            if (btnNext) {
                btnNext.disabled = errors.length > 0;
            }
        }

        function goBack() {
            if (currentStep > 1) {
                currentStep--;
                renderCurrentStep();
            }
        }

        function goNext() {
            const errors = validateStep(currentStep);
            
            if (errors.length > 0) {
                showErrors(errors);
                return;
            }
            
            if (currentStep < 12) {
                currentStep++;
                renderCurrentStep();
                window.scrollTo(0, 0);
            }
        }

        async function finishAnketa() {
            const errors = validateStep(currentStep);
            
            if (errors.length > 0) {
                showErrors(errors);
                return;
            }
            
            anketaData.meta.completed_at = new Date().toISOString();
            
            const result = getAnketaResult();
            
            try {
                const btnFinish = document.getElementById('btnNext');
                if (btnFinish) {
                    btnFinish.textContent = 'Отправка...';
                    btnFinish.disabled = true;
                }
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(result)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('✅ Заявка успешно отправлена:', data);
                } else {
                    console.error('❌ Ошибка отправки:', data.error);
                }
            } catch (error) {
                console.error('❌ Ошибка соединения с сервером:', error);
            }
            
            currentStep = 13;
            renderCurrentStep();
            window.scrollTo(0, 0);
            
            console.log('Результат анкеты:', JSON.stringify(result, null, 2));
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderCurrentStep();
        });
    </script>
</body>
</html>
